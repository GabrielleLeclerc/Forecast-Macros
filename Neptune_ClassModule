' Class: cDictionary
Option Explicit

Private mKeys As Collection
Private mItems As Collection

Private Sub Class_Initialize()
    Set mKeys = New Collection
    Set mItems = New Collection
End Sub

Public Property Get Count() As Long
    Count = mKeys.Count
End Property

Public Function Exists(ByVal key As String) As Boolean
    Exists = (IndexOf(key) > 0)
End Function

Public Sub Add(ByVal key As String, ByVal item As Variant)
    ' Mimic Scripting.Dictionary: Add throws if duplicate
    If Exists(key) Then Err.Raise 457, , "Key already exists: " & key
    mKeys.Add key
    mItems.Add item
End Sub

Public Sub Remove(ByVal key As String)
    Dim i As Long: i = IndexOf(key)
    If i > 0 Then
        mKeys.Remove i
        mItems.Remove i
    End If
End Sub

' --- Default Item getter/setter like Scripting.Dictionary(key) ---

' Get
Public Default Property Get Item(ByVal key As String) As Variant
    Dim i As Long: i = IndexOf(key)
    If i > 0 Then Item = mItems(i)
End Property

' Let for values (non-objects)
Public Property Let Item(ByVal key As String, ByVal val As Variant)
    Dim i As Long: i = IndexOf(key)
    If i > 0 Then
        mItems.Remove i
        mItems.Add val, , i
    Else
        mKeys.Add key
        mItems.Add val
    End If
End Property

' Set for object values (rarely needed here)
Public Property Set Item(ByVal key As String, ByVal val As Object)
    Dim i As Long: i = IndexOf(key)
    If i > 0 Then
        Set mItems(i) = val
    Else
        mKeys.Add key
        mItems.Add val
    End If
End Property

Public Function Keys() As Variant
    Dim n As Long: n = mKeys.Count
    Dim arr() As Variant
    ReDim arr(0 To IIf(n = 0, 0, n - 1))
    Dim i As Long
    For i = 1 To n
        arr(i - 1) = mKeys(i)
    Next
    Keys = arr
End Function

' --- helpers ---
Private Function IndexOf(ByVal key As String) As Long
    Dim i As Long
    For i = 1 To mKeys.Count
        If StrComp(mKeys(i), key, vbTextCompare) = 0 Then
            IndexOf = i
            Exit Function
        End If
    Next i
End Function
